
</<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Flora of Middle Earth</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css">
    <link rel="stylesheet" type="text/css" href="lib/d3.parcoords.css">
    <script src="lib/d3.min.js"></script>
    <script src="lib/sylvester.js"></script>
    <script src="lib/slickgrid/jquery-1.7.min.js"></script>
    <script src="lib/underscore.js"></script>
    <script src="lib/underscore.math.js"></script>
    <script src="lib/d3.parcoords.js"></script>
    <script src="//d3js.org/d3.v4.min.js"></script>

    <script src="main.js"></script>
</head>
<style>
    .node circle {
        fill: #619960;
    }

    .node text {
        font: 10px sans-serif;
    }

    .node--internal circle {
        fill: #619960;
    }

    .node--internal text {
        text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;
    }

    .link {
        fill: none;
        stroke: #619960;
        stroke-opacity: 0.4;
        stroke-width: 1.5px;
    }

    form {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        position: absolute;
        left: 10px;
        top: 10px;
    }

    label {
        display: block;
    }
</style>
<style>
    svg {
        font: 10px sans-serif;
    }

    .background path {
        fill: none;
        stroke: #ddd;
        shape-rendering: crispEdges;
    }

    .foreground path {
        fill: none;
        stroke: steelblue;
    }

    .brush .extent {
        fill-opacity: .3;
        stroke: #fff;
        shape-rendering: crispEdges;
    }

    .axis line,
    .axis path {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

    .axis text {
        text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
        cursor: move;
    }

</style>
<style>
    .links line {
        stroke: #999;
        stroke-opacity: 0.6;
    }

    .nodes circle {
        stroke: #fff;
        stroke-width: 1.5px;
    }

    text {
        font-family: sans-serif;
        font-size: 10px;
    }
</style>

<!-- <form>
    <label><input type="radio" name="mode" value="cluster" checked> Dendrogram</label>
    <label><input type="radio" name="mode" value="tree"> Tree</label>
</form> -->
<div>
<svg id="tree" width="800" height="1200"></svg>
<svg id="text" width="2000" height="2000"></svg>
<img src="emotion.png" alt="emotion parallel coordinates">
</div>
<script>

    var svg = d3.select("#tree"),
        width = +svg.attr("width"),
        height = +svg.attr("height"),
        g = svg.append("g").attr("transform", "translate(100,0)");

    var tree = d3.tree()
        .size([height - 400, width - 160]);

    var cluster = d3.cluster()
        .size([height, width - 160]);

    var stratify = d3.stratify()
        .parentId(function (d) { return d.id.substring(0, d.id.lastIndexOf(".")); });

    d3.csv("data/florageneral.csv", function (error, data) {
        if (error) throw error;

        var root = stratify(data)
            .sort(function (a, b) { return (a.height - b.height) || a.id.localeCompare(b.id); });

        cluster(root);

        var link = g.selectAll(".link")
            .data(root.descendants().slice(1))
            .enter().append("path")
            .attr("class", "link")
            .attr("d", diagonal);

        var node = g.selectAll(".node")
            .data(root.descendants())
            .enter().append("g")
            .attr("class", function (d) { return "node" + (d.children ? " node--internal" : " node--leaf"); })
            .attr("transform", function (d) { return "translate(" + d.y + "," + d.x + ")"; });

        node.append("circle")
            .attr("r", 2.5);

        node.append("text")
            .attr("dy", 3)
            .attr("x", function (d) { return d.children ? -8 : 8; })
            .style("text-anchor", function (d) { return d.children ? "end" : "start"; })
            .text(function (d) { return d.id.substring(d.id.lastIndexOf(".") + 1); });

        d3.selectAll("input")
            .on("change", changed);

        var timeout = setTimeout(function () {
            d3.select("input[value=\"tree\"]")
                .property("checked", true)
                .dispatch("change");
        }, 1000);

        function changed() {
            timeout = clearTimeout(timeout);
            (this.value === "tree" ? tree : cluster)(root);
            var t = d3.transition().duration(750);
            node.transition(t).attr("transform", function (d) { return "translate(" + d.y + "," + d.x + ")"; });
            link.transition(t).attr("d", diagonal);
        }
    });

    function diagonal(d) {
        return "M" + d.y + "," + d.x
            + "C" + (d.parent.y + 100) + "," + d.x
            + " " + (d.parent.y + 100) + "," + d.parent.x
            + " " + d.parent.y + "," + d.parent.x;
    }

</script>
<svg id="text" width="2000" height="2000"></svg>
<script>

    var svg = d3.select("#text"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

    var colors = ['#619960', '#60998f', '#a3ccb2', '#4a7799', '#62724c'];


    var color = d3.scaleOrdinal()
        .range(colors);

    var simulation = d3.forceSimulation()
        .force("link", d3.forceLink().id(function (d) { return d.id; }))
        .force("charge", d3.forceManyBody())
        .force("center", d3.forceCenter(width / 2, height / 2));

    d3.json("data/conceptkeyword.json", function (error, graph) {
        if (error) throw error;

        var link = svg.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(graph.links)
            .enter().append("line")
            .attr("stroke-width", function (d) { return Math.sqrt(d.sourceRelevance); });

        var node = svg.append("g")
            .attr("class", "nodes")
            .selectAll("g")
            .data(graph.nodes)
            .enter().append("g")

        var circles = node.append("circle")
            .attr("r", 15)
            .attr("fill", function (d) { return color(d.group); })
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        var lables = node.append("text")
            .text(function (d) {
                return d.id;
            })
            .attr('x', 6)
            .attr('y', 3);

        node.append("title")
            .text(function (d) { return d.id; });

        simulation
            .nodes(graph.nodes)
            .on("tick", ticked);

        simulation.force("link")
            .links(graph.links);

        function ticked() {
            link
                .attr("x1", function (d) { return d.source.x; })
                .attr("y1", function (d) { return d.source.y; })
                .attr("x2", function (d) { return d.target.x; })
                .attr("y2", function (d) { return d.target.y; });

            node
                .attr("transform", function (d) {
                    return "translate(" + d.x + "," + d.y + ")";
                })
        }
    });

    function dragstarted(d) {
        if (!d3.event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }

    function dragged(d) {
        d.fx = d3.event.x;
        d.fy = d3.event.y;
    }

    function dragended(d) {
        if (!d3.event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    }

</script>
<script id="coloring-basic">var colors = d3.scale.category20b();

    // create a chart in every element with class "parcoords-coloring"
    d3.selectAll(".parcoords-coloring")
        .each(function (d, i) {
            var color = colors(i);

            var chart = d3.parcoords()(this)
                .data(data3.slice(7 * i, 7 * i + 30))
                .alpha(0.6)
                .color(color)
                .margin({
                    top: 0,
                    left: 0,
                    bottom: 24,
                    right: 0
                })
                .render();

            // color labels
            var text = chart.svg.append("text")
                .attr("x", 162)
                .attr("y", 64)
                .style({
                    "text-anchor": "end",
                    "font-weight": "bold",
                    "font-size": "11px",
                    "fill": "#ddd"
                })
                .text(colors(i))

            // hover effect
            d3.select(this).on({
                "mouseover": function () { text.style("fill", "#222"); },
                "mouseout": function () { text.style("fill", "#ddd"); }
            })
        });
</script>
<div id="emotions" class="parcoords" style="width:1230px;margin-left:-250px;height:270px;"></div>
<script>
    // load csv file and create the chart
    d3.csv('data/passages_emotion.csv', function (data) {
        var colorgen = d3.scale.ordinal()
            .range(["#a6cee3", "#1f78b4", "#b2df8a", "#33a02c",
                "#fb9a99", "#e31a1c", "#fdbf6f", "#ff7f00",
                "#cab2d6", "#6a3d9a", "#ffff99", "#b15928"]);

        var color = function (d) { return colors(d.group); };

        var parcoords = d3.parcoords()("#emotions")
            .data(data)
            .hideAxis(["name"])
            .color(color)
            .alpha(0.25)
            .composite("darken")
            .margin({ top: 24, left: 500, bottom: 12, right: 0 })
            .mode("queue")
            .render()
            .brushMode("1D-axes");  // enable brushing

        parcoords.svg.selectAll("text")
            .style("font", "10px sans-serif");
    });
</script>
<script>
    // Code viewer
    d3.selectAll(".show-code").on("click", function (d) {
        var code = d3.select("#" + d3.select(this).attr("data-code")).text();
        d3.select(this.parentNode)
            .text(code)
        event.preventDefault();
    })
</script>


</html>